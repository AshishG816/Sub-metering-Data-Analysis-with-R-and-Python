---
title: "R Notebook on Sub-metering Data"
output: rmarkdown::github_document
---
Dataset:
Measurement of electric power consumption in one household with a one-minute sampling rate over a period of almost 4 years that can be found on:
http://archive.ics.uci.edu/ml/datasets/Individual+household+electric+power+consumption

Reading/Background Article Sub-metering for Electricity located:
https://s3.amazonaws.com/gbstool/courses/793/docs/IV2p.pdf?AWSAccessKeyId=AKIAJBIZLMJQ2O6DKIAA&Expires=1500454800&Signature=pzpAYFsGeQGPZgsQ%2FvPr3BV3qVI%3D

Task: 
Given over 2 million minutes of continuous electric power comsumption, can we make a case for the cost with installing sub-metering in a household or business complex?
________________________________________________________________________________________________________________

Our focus will be using the dplyr package to make the dataset more easily understandable and analyzable in looking for trends.

Upon loading the data set, we take a summary to get an idea of the data. 
```{r}
summary(household_power_consumption)

```

Note per my own personal norm, in order to preserve the integrity of the original dataset as well as the various modified versions, whenever drastic changes are made, the new dataframe is given a new name.

We first notice that the We observe that "Date" and time are identified as a character strings and not a value. Time by default needs to be connected to a date to be recognized as time. Thus, first we will change the "Date" column and then we will combine "Date" and "Time" into one column and move in front.

```{r}
household_power_consumption$Date<-as.Date(household_power_consumption$Date, "%d/%m/%Y" )
summary(household_power_consumption)

```
```{r}
hpc_new<-cbind(household_power_consumption,paste(household_power_consumption$Date,household_power_consumption$Time), stringsAsFactors=FALSE)
colnames(hpc_new)[10] <-"DateTime"
hpc_new<- hpc_new[,c(ncol(hpc_new), 1:(ncol(hpc_new)-1))]
hpc_new$DateTime<-strptime(hpc_new$DateTime, format=" %Y-%m-%d %H:%M:%S")
summary(hpc_new)
```

Finally, we notice there are NAs throughout the data. Given we will be doing some statistical analysis and do not want this to skew our results or cause errors in our functions, we will remove the NA's which will finish our initial preprocessing of the data.

```{r}
hpc_new_noNA<-na.omit(hpc_new)
summary(hpc_new_noNA)
```

Now that our data is pretty clean and manageable, we will consider the task at hand.

Our goal is to see if we can give an argument to whether Sub-metering is would be cost efficient to install in an apartment complex based on the readings we have from the electricity usage of a home with sub-metering.

First off, we note there are three sub-meters sections which report electricity usage in watts per minute and that the global active power (GAP) reading in active power in kilowatts for minute averaged. Thus, if we would want to calculate the total miscellaneous electricity used not reported in by the sub-metering we would need to convert the GAP units to watt per minute. Then we would take the difference of GAP in watts per minute and the total of three sub-meters.

```{r}
hpc_rev<-hpc_new_noNA
hpc_rev$GAP_WtPerMin<-hpc_rev$Global_active_power*1000/60
hpc_rev$Sub_Met_Total<-hpc_rev$Sub_metering_1+hpc_rev$Sub_metering_2+hpc_rev$Sub_metering_3
hpc_rev$GAP_SubMet_Diff<-hpc_rev$GAP_WtPerMin-hpc_rev$Sub_Met_Total
summary(hpc_rev)

```

Now that it looks like we have all the data needed to start our analysis, 

There are various differnt ways to analyze data and look for trends. Given the data is provided sequentially by minutes but electricity is usually billed monthly, it would make sense to group the minutes by months. In order to do this, we would first need to break down the date by month. 

```{r}
hpc_rev$Month <- as.numeric(format(as.Date(hpc_rev$Date), "%m"))
hpc_rev$Month_Yr <- as.character(format(as.Date(hpc_rev$Date), "%Y-%m"))
summary(hpc_rev)
```

Now that we have the data grouped by months, we want to compare the different electricity usage. Since months have different number of days, it is better to take the average than take sums.

Now using the dplyr package in R we can group the data while taking the average usages.

```{r}
hpc_rev_Mo_Yr_Mean_Summary<-hpc_rev %>% group_by(Month_Yr) %>% summarise(GAP_Mean=mean(Global_active_power), GRP_Mean=mean(Global_reactive_power), Voltage_Mean=mean(Voltage), GI_Mean=mean(Global_intensity), SubM1_Mean=mean(Sub_metering_1),  SubM2_Mean=mean(Sub_metering_2), SubM3_Mean=mean(Sub_metering_3), GAP_WtPerMin_Mean=mean(GAP_WtPerMin), GAP_SubMet_Diff_Mean=mean(GAP_SubMet_Diff))
hpc_rev_Mo_Yr_Mean_Summary

```

Now we have grouped by months chronologically, we will also group by only months in order to be able to see trends of each month across the years.

```{r}
hpc_rev_Mo_Mean_Summary<-hpc_rev %>% group_by(Month) %>% summarise(GAP_Mean=mean(Global_active_power), GRP_Mean=mean(Global_reactive_power), Voltage_Mean=mean(Voltage), GI_Mean=mean(Global_intensity), SubM1_Mean=mean(Sub_metering_1),  SubM2_Mean=mean(Sub_metering_2), SubM3_Mean=mean(Sub_metering_3), GAP_WtPerMin_Mean=mean(GAP_WtPerMin), GAP_SubMet_Diff_Mean=mean(GAP_SubMet_Diff))
hpc_rev_Mo_Mean_Summary
```

Now using ggplot, we can use the R visualization package to try and get a better handle on the trends on the data.

```{r}
hpc_rev_Mo_Yr_Mean_Summary%>% gather(key, Watts, GAP_WtPerMin_Mean,SubM1_Mean, SubM2_Mean, SubM3_Mean,GAP_SubMet_Diff_Mean) %>% ggplot(aes(group =key, x=Month_Yr,y=Watts,colour=key))+geom_line()+ theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

This gives a good idea of the average Watts/Minute electricity usage. One thing that is immediately apparent is that the majority of electricity used is not reported by the sub-metered sections but is miscellaneous, i.e. the GAP_SubMet_Diff_Mean, usage reported. This means based off of the current data reported it would be difficult to make any solid case for using sub-metering.

Nonetheless, let us also investigate the trends we can see by grouping the data by only months.

```{r}
hpc_rev_Mo_Mean_Summary %>% gather(key, Watts, GAP_WtPerMin_Mean,SubM1_Mean, SubM2_Mean, SubM3_Mean,GAP_SubMet_Diff_Mean) %>% ggplot(aes(group=key, x=Month,y=Watts,colour=key))+geom_line()+ theme(axis.text.x = element_text(angle = 45, hjust = 1))+scale_x_discrete(name="Months Grouped By Year",limits=c(1,3,6,9,12))
```

As we immediately can see, while the graph is useful and we can easily see that during the November to early February, the electricity usage is the highest. And from June to late August, it reaches the minimum usage, this 